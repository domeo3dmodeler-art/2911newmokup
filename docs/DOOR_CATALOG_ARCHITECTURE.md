# Архитектура каталога дверей: модели, цвета и цены

## Бизнес-правило

**Цвет не влияет на цену.** На цену влияют только: модель, покрытие, размеры, наполнение. Цвет не зависит от размера двери — это лишь визуальный выбор для отображения.

Поэтому **держать в БД отдельный товар на каждый цвет не нужно** — это лишнее дублирование. В БД храним цены/товары только по комбинации: модель + покрытие + размер + наполнение. Цвета — только для отображения (справочник/фото).

---

## Текущая ситуация («кривота»)

- **Product** — одна запись = один «товар» из импорта. В `properties_data`: Код модели, Стиль, Тип покрытия, Цвет/Отделка, размеры, наполнение, Цена РРЦ. В Excel часто **одна строка на (модель, покрытие, размер)** с одним цветом (например, бежевый). Остальных цветов в Product нет.
- **PropertyPhoto** — модель|покрытие|цвет → фото. Список **цветов для UI** берётся отсюда.
- **Итог:** в UI все цвета из PropertyPhoto, а цена ищется по Product с учётом цвета → для части цветов записи нет, цена «не находится». В коде пришлось добавить fallback: подставлять цену «по одному товару на покрытие».

Правильно: **цена в БД не привязана к цвету**, а в коде расчёта цены цвет не учитывать — искать только по (модель, покрытие, размер, наполнение).

---

## Правильная архитектура (рекомендация)

### Один «товар/цена» на комбинацию без цвета

- **Product** (или отдельная таблица цен): **модель + стиль + покрытие + размер + наполнение** → цена, SKU. Поля **Цвет/Отделка в расчёте цены не участвуют** (можно не хранить в Product для дверей или игнорировать при поиске).
- **Цвета и фото:** только PropertyPhoto (модель|покрытие|цвет → фото) — для списка цветов в конфигураторе и картинок. Отдельной таблицы под цвета не обязательно.

**Итог в БД:**

- Товаров/цен: **модели × покрытия × размеры × наполнения** — без умножения на количество цветов.
- Цвета: только в PropertyPhoto (или небольшой справочник), только для отображения.

**В коде:**

- **Расчёт цены:** при подборе товара для цены фильтровать только по (модель, стиль, покрытие, размер, наполнение); цвет не использовать. Одна запись — одна цена на всё покрытие для любого выбранного цвета.
- **Фильтры конфигуратора и каталог:** цвет по-прежнему участвует — привязка к Названию модели, список цветов по покрытию (из PropertyPhoto), выбор пользователя, отображение фото. Цвет не влияет на цену, но участвует в фильтрах и отображении.

---

## Что сделать практически

1. **Логика цены (doors-price-engine):** при подборе товара по выбору пользователя **не учитывать цвет** — только модель, стиль, покрытие, размер, наполнение. Тогда одной записи Product на (модель, покрытие, размер, наполнение) достаточно для всех цветов этого покрытия.
2. **Импорт:** оставить одну строку Product на (модель, покрытие, размер, наполнение); не создавать дубликаты по цветам.
3. **Complete-data / UI:** список цветов по-прежнему из PropertyPhoto; цена одна на всё покрытие, подставляется независимо от выбранного цвета.

Так архитектура соответствует правилу «цвет не зависит от размера и не влияет на цену» — и лишних товаров в БД нет.

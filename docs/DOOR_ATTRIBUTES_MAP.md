# Карта атрибутов дверей: Excel → БД → API

Документ фиксирует, **какие атрибуты у дверей есть** (откуда берутся), **какие использует API/калькулятор**, и **каких нет вообще** (ожидаются кодом, но не заполняются из Excel).

---

## 1. Что импорт записывает в Product.properties_data (двери)

Источник — листы final_filled 30.01.xlsx. Один товар двери = одна строка «Цены базовые» × разворот по размерам (ширина × высота) × тип покрытия; к нему подтягиваются Опции, Стекло_доступность, Наценка за кромку по «Название модели».

| Ключ в properties_data | Источник | Есть в Excel |
|------------------------|----------|--------------|
| Код модели Domeo (Web) | Цены базовые | ✓ |
| Название модели | Цены базовые | ✓ |
| Domeo_Название модели для Web | Цены базовые → Название модели | ✓ |
| Артикул поставщика | Цены базовые → Код модели Domeo (Web) | ✓ |
| Стиль Domeo (Web), Domeo_Стиль Web | Цены базовые | ✓ |
| Ширина/мм, Высота/мм | Цены базовые (разворот) | ✓ |
| Тип покрытия | Цены базовые | ✓ |
| Поставщик, Толщина мм, Стекло, Кромка в базе, Цена опт, Цена РРЦ | Цены базовые | ✓ |
| Domeo_Опции_Название_наполнения | Опции | ✓ |
| Domeo_Опции_Звукоизоляция_дБ | Опции | ✓ |
| Domeo_Опции_Надбавка_2301_2500_процент, 2501_3000_процент | Опции | ✓ |
| Domeo_Опции_Реверс_доступен, Надбавка_реверс_руб | Опции | ✓ |
| Domeo_Опции_Порог_доступен, Цена_порога_руб | Опции | ✓ |
| Domeo_Опции_Зеркало_доступно, одна_сторона_руб, две_стороны_руб | Опции | ✓ |
| Domeo_Опции_Поставщик | Опции → Поставщик | ✓ |
| Domeo_Стекло_доступность (массив) | Стекло_доступность | ✓ |
| Domeo_Стекло_Поставщики (массив) | Стекло_доступность → Поставщик | ✓ |
| Domeo_Цвет_Поставщики (массив) | Цвет → Поставщик | ✓ |
| Domeo_Кромка_в_базе_включена, базовая_цвет, Цвет_2–4, Наценка_Цвет_2–4 и др. | Наценка за кромку | ✓ |

---

## 2. Что читает API расчёта цены и конфигуратор

- **Подбор товара двери:** стиль, модель (код/название), тип покрытия, цвет, ширина, высота, тип конструкции.
- **Цена:** Цена РРЦ, надбавки реверс/зеркало/порог/кромка, ручка, комплект, ограничитель, наличники.

Конкретные ключи из `properties_data`, которые читает код (price/doors, complete-data и т.д.):

| Ключ | Где читается | Заполняется импортом |
|------|--------------|----------------------|
| Domeo_Стиль Web | price/doors, complete-data | ✓ Цены базовые |
| Код модели Domeo (Web), Артикул поставщика, Domeo_Название модели для Web | price/doors, complete-data | ✓ |
| Тип покрытия | price/doors, complete-data | ✓ Цены базовые |
| **Domeo_Цвет** | price/doors (фильтр по цвету) | **Нет** — цвет из выбора пользователя; в товаре может быть пусто (null допускается) |
| **Тип конструкции** | price/doors (typeMatch) | **Нет** — в Excel столбца нет, в БД не пишется |
| Ширина/мм, Высота/мм | price/doors | ✓ |
| Цена РРЦ | price/doors | ✓ |
| Domeo_Опции_Надбавка_реверс_руб, Зеркало_одна_сторона_руб, две_стороны_руб, Цена_порога_руб | price/doors | ✓ из Опции |
| Domeo_Кромка_базовая_цвет, Domeo_Кромка_Цвет_2–4, Domeo_Кромка_Наценка_Цвет_2–4 | price/doors | ✓ из Наценка за кромку |

---

## 3. Атрибуты, которых «нет вообще»

Под этим имеется в виду: **код их использует, но в Excel такого столбца нет и импорт их не заполняет**.

| Атрибут | Где используется | Что делать |
|---------|------------------|------------|
| **Тип конструкции** | `app/api/price/doors/route.ts` — фильтр `typeMatch` (selection.type). Сейчас у товаров дверей этого поля нет, поэтому при передаче `type` в selection подходящий товар может не найтись. | Либо добавить столбец «Тип конструкции» в лист «Цены базовые» и прокинуть в импорт в `properties_data['Тип конструкции']`, либо не передавать/не фильтровать по типу конструкции в UI. |
| **Domeo_Цвет** | В товаре не хранится — цвет выбирается в конфигураторе из списка (лист «Цвет» → PropertyPhoto). В price/doors допускается `properties['Domeo_Цвет'] == null` (любой цвет). Если нужна разная цена по цвету, придётся завести отдельный учёт (например, товар на комбинацию размер+покрытие+цвет). | Сейчас поведение корректное: один товар на размер+покрытие, цвет не в товаре. |

---

## 4. Ранее неиспользуемые столбцы (теперь импортируются)

По вашему запросу добавлен импорт следующих полей в `properties_data`:

- **Цвет:** Поставщик → `Domeo_Цвет_Поставщики` (по модели, массив уникальных значений)  
- **Опции:** Поставщик → `Domeo_Опции_Поставщик`  
- **Стекло_доступность:** Поставщик → `Domeo_Стекло_Поставщики` (массив)  
- **Наличники:** Поставщик → `Поставщик`  
- **04 Ручки Завертки:** Цена продажи (руб), Цена закупки (руб), Порядок сортировки  
- **05 Ограничители:** ID товара, Цена опт (руб)  

---

## 5. Итог

- **Есть в Excel и импортируются:** все столбцы, перечисленные в разделе 1, плюс ранее добавленные в разделе 4.
- **Нет в Excel и не заполняются:** **Тип конструкции** (если нужна фильтрация по типу — добавить в «Цены базовые» и в импорт). **Domeo_Цвет** в товаре сознательно не хранится — цвет из конфигуратора.
- **Есть в Excel, но не импортируются:** проверьте актуальный список в `docs/EXCEL_SHEETS_AUDIT.md` (формируется скриптом после каждого обновления импорта).

Полный поколоночный аудит листов файла: **`npx tsx scripts/audit-excel-sheets.ts`** → отчёт в `docs/EXCEL_SHEETS_AUDIT.md`.

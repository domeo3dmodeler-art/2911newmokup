# Несоответствия данных и правила, зафиксированные в ПО

Документ создаётся скриптом `scripts/verify-excel-db-and-links.ts`.

---

## 1. Правила по умолчанию (реализованы в коде)

| Ситуация | Правило в ПО | Где реализовано |
|-----------|---------------|------------------|
| Модель из «Цены базовые» **нет** в листе «Наценка за кромку» | **Кромка включена в базовую цену** = **Нет** | Импорт: `import-final-filled.ts` (для товара двери задаётся `Domeo_Кромка_в_базе_включена = "Нет"`) |
| Модель из «Цены базовые» **нет** в листе «Стекло_доступность» | **Стекло не доступно** (пустой список цветов стекла) | Импорт: не заполняется `Domeo_Стекло_доступность`; в API/калькуляторе для модели возвращается пустой массив вариантов стекла |
| Строка из «Наценка за кромку», модели которой **нет** в «Цены базовые» | Для такой строки считаем **Кромка включена в базовую цену** = **Нет** (строка не используется ни для одного товара двери) | Документировано; при импорте эти строки не привязываются к товарам |

### 1.1 Почему в БД меньше записей дверей, чем комбинаций в развороте

В «Цены базовые» при развороте по размерам получается **2323** комбинаций (строка × ширина × высота). В БД записей дверей: **2091**. Уникальных SKU (как в импорте): **2091**.

Импорт использует **SKU = door_код_модели_ширина_высота_покрытие**. Для каждой комбинации (код, размеры, тип покрытия) создаётся отдельная запись с соответствующей базовой ценой из листа «Цены базовые». Таким образом **тип покрытия влияет на базовую цену двери**: разным покрытиям соответствуют разные товары и разные цены РРЦ.

### 1.2 Правила согласованности Excel

- Если у модели в «Цены базовые» столбец **Стекло** = **Да**, модель должна быть во вкладке **Стекло_доступность**.
- Если у модели в «Цены базовые» столбец **Кромка в базе** = **Да**, модель должна быть во вкладке **Наценка за кромку**.

**Нарушения (Стекло=Да, но модели нет в Стекло_доступность):**
Количество: 3

- ДПГ Флекс Эмаль Порта-51 4AB
- ДПГ Флекс Эмаль Порта-51 4AB
- ДПГ Флекс Эмаль Порта-51 4AB

**Нарушения (Кромка в базе=Да, но модели нет в Наценка за кромку):**
Количество: 7

- ДПГ Флекс Эмаль Порта- 4AB Черный: М
- ДПГ Флекс Эмаль Порта-52 4AB Черный: М
- ДПГ Флекс Эмаль Порта-52 4AB Черный: М
- ДПГ Флекс Эмаль Порта-52 4AB Черный: М
- Дверь IN Flain 3 ДГ КП
- Дверь IN Flain 3 ДГ КП
- Дверь IN Flain 3 ДГ КП


---

## 2. Модели с применёнными умолчаниями

### 2.1 Кромка: «Кромка включена в базовую цену» = Нет

Для следующих моделей из «Цены базовые» в листе «Наценка за кромку» нет строки — в БД и калькуляторе применяется значение **Нет**.

**Количество:** 80

- ДПГ Классико-70
- ДПГ Классико-92
- ДПГ Флекс Эмаль Неоклассико-11
- ДПГ Флекс Эмаль Неоклассико-12
- ДПГ Флекс Эмаль Порта ПТА-50.11 B
- ДПГ Флекс Эмаль Порта- 4AB Черный: М
- ДПГ Флекс Эмаль Порта-52 4AB Черный: М
- Дверное полотно Canva 1 ПГ иск.п.
- Дверное полотно Canva 2 ПГ иск.п.
- Дверное полотно DUET 1 ПГ кр.
- Дверное полотно DUET 10 ПГ кр.
- Дверное полотно DUET 3 ПГ кр.
- Дверное полотно Elegance 1 ПГ иск.п.
- Дверное полотно Elegance 2 ПГ иск.п.
- Дверное полотно Elegance 3 ПГ иск.п.
- Дверное полотно Erte 1 ПГ Cannelure кр.
- Дверное полотно Erte 1 ПГ Rustica кр.
- Дверное полотно Erte 2 ПГ Rustica кр.
- Дверное полотно Florenzia 2 ПГ кр.
- Дверное полотно Neo 1 ПГ иск.п.
- Дверное полотно Neo 2 ПГ иск.п.
- Дверное полотно Neo 3 ПГ иск.п.
- Дверное полотно Neo 4 ПГ иск.п.
- Дверное полотно Omega 1 ПГ кр.
- Дверное полотно Omega 2 ПГ кр.
- Дверное полотно Omega 3 ПГ кр.
- Дверное полотно Omega 4 ПГ кр.
- Дверное полотно Omega 5 ПГ кр.
- Дверное полотно Rimini 1 ПГ кр.
- Дверное полотно Rimini 10 ПГ кр.
- Дверное полотно Rimini 12 ПГ кр.
- Дверное полотно Rimini 2 ПГ кр.
- Дверное полотно Rimini 3 ПГ кр.
- Дверное полотно Twin 1 ПГ Rustica кр.
- Дверное полотно Twin 2 ПГ Rustica кр.
- Дверное полотно Twin 3 ПГ Rustica кр.
- Дверное полотно Twin 3 ПГ Tempo кр.
- Дверное полотно Twin 4 ПГ Rustica кр.
- Дверное полотно Twin 4 ПГ Tempo кр.
- Дверь Amare 1 ДГ
- Дверь Amare 1 эмаль ДГ
- Дверь Amare 2 ДГ
- Дверь Amare 2 эмаль ДГ
- Дверь En1 ДГ
- Дверь En5 ДГ
- Дверь Enigma 1 ДГ
- Дверь Enigma 2 ДГ
- Дверь Enigma 3 ДГ
- Дверь Enigma 4 ДГ
- Дверь Enigma 5 ДГ
- Дверь Enika 1 ДГ
- Дверь Enika 3 ДГ
- Дверь Enika 5 ДГ
- Дверь IN Flain 3 ДГ КП
- Дверь Molis 1 эмаль ДГ
- Дверь Monte 1 ДГ
- Дверь Monte 1 эмаль ДГ
- Дверь Monte 3 ДГ
- Дверь Monte 3 эмаль ДГ
- Дверь Monte 7 ДГ
- Дверь Monte 7 эмаль ДГ
- Дверь Novva 1 ДГ
- Дверь Novva 1 эмаль ДГ
- Дверь Novva 11 ДГ
- Дверь Novva 11 эмаль ДГ
- Дверь Novva 3 ДГ
- Дверь Novva 3 эмаль ДГ
- Дверь Novva 5 ДГ
- Дверь Novva 5 эмаль ДГ
- Дверь Novva 9 ДГ
- Дверь Novva 9 эмаль ДГ
- Дверь Se1 ДГ
- Дверь Se3 ДГ
- Дверь Se5 ДГ
- Дверь Venezia 1 ДГ
- Дверь Venezia 1 эмаль ДГ
- Дверь Venezia 2 ДГ
- Дверь Venezia 2 эмаль ДГ
- Дверь Гладкое ДГ
- Дверь Гладкое эмаль ДГ

---

### 2.2 Стекло: не доступно

Для следующих моделей из «Цены базовые» в листе «Стекло_доступность» нет строки — в калькуляторе для них не показывается выбор цвета стекла (стекло не доступно).

**Количество:** 104

- ДПГ Классико-70
- ДПГ Классико-92
- ДПГ Флекс Эмаль Неоклассико-11
- ДПГ Флекс Эмаль Неоклассико-12
- ДПГ Флекс Эмаль Порта ПТА-50 B
- ДПГ Флекс Эмаль Порта ПТА-50.11 B
- ДПГ Флекс Эмаль Порта- 4AB Черный: М
- ДПГ Флекс Эмаль Порта-51 4AB
- ДПГ Флекс Эмаль Порта-52 4AB Черный: М
- Дверное полотно BASE 1 ПГ иск.п.
- Дверное полотно Canva 1 ПГ иск.п.
- Дверное полотно Canva 2 ПГ иск.п.
- Дверное полотно DUET 1 ПГ кр.
- Дверное полотно DUET 10 ПГ кр.
- Дверное полотно DUET 3 ПГ кр.
- Дверное полотно Elegance 1 ПГ иск.п.
- Дверное полотно Elegance 2 ПГ иск.п.
- Дверное полотно Elegance 3 ПГ иск.п.
- Дверное полотно Erte 1 ПГ Cannelure кр.
- Дверное полотно Erte 1 ПГ Rustica кр.
- Дверное полотно Erte 2 ПГ Rustica кр.
- Дверное полотно Florenzia 2 ПГ кр.
- Дверное полотно Neo 1 ПГ иск.п.
- Дверное полотно Neo 2 ПГ иск.п.
- Дверное полотно Neo 3 ПГ иск.п.
- Дверное полотно Neo 4 ПГ иск.п.
- Дверное полотно Omega 1 ПГ кр.
- Дверное полотно Omega 2 ПГ кр.
- Дверное полотно Omega 3 ПГ кр.
- Дверное полотно Omega 4 ПГ кр.
- Дверное полотно Omega 5 ПГ кр.
- Дверное полотно Rimini 1 ПГ кр.
- Дверное полотно Rimini 10 ПГ кр.
- Дверное полотно Rimini 12 ПГ кр.
- Дверное полотно Rimini 2 ПГ кр.
- Дверное полотно Rimini 3 ПГ кр.
- Дверное полотно Ritm Metr 2 ПГ кр.
- Дверное полотно Twin 1 ПГ Rustica кр.
- Дверное полотно Twin 2 ПГ Rustica кр.
- Дверное полотно Twin 3 ПГ Rustica кр.
- Дверное полотно Twin 3 ПГ Tempo кр.
- Дверное полотно Twin 4 ПГ Rustica кр.
- Дверное полотно Twin 4 ПГ Tempo кр.
- Дверь Amare 1 ДГ
- Дверь Amare 1 эмаль ДГ
- Дверь Amare 2 ДГ
- Дверь Amare 2 эмаль ДГ
- Дверь En1 ДГ
- Дверь En5 ДГ
- Дверь Enigma 1 ДГ
- Дверь Enigma 2 ДГ
- Дверь Enigma 3 ДГ
- Дверь Enigma 4 ДГ
- Дверь Enigma 5 ДГ
- Дверь Enika 1 ДГ
- Дверь Enika 3 ДГ
- Дверь Enika 5 ДГ
- Дверь IFL9 Reverse ДГ КП
- Дверь IN Flain 3 ДГ КП
- Дверь IN Flain 4 ДГ КП
- Дверь IN44 ДГ КП
- Дверь In20 ДГ КП
- Дверь In20 эмаль ДГ КП
- Дверь In27 ДГ КП
- Дверь In27 эмаль ДГ КП
- Дверь In39 ДГ КП
- Дверь In39 эмаль ДГ КП
- Дверь In40 ДГ КП
- Дверь In40 эмаль ДГ КП
- Дверь In9 Invisible box ДГ Универсальное КП
- Дверь InM1.1 ДГ КП
- Дверь InM1.1 эмаль ДГ КП
- Дверь InM2 ДГ КП
- Дверь InM2 эмаль ДГ КП
- Дверь InM2.1 ДГ КП
- Дверь InM2.1 эмаль ДГ КП
- Дверь Molis 1 эмаль ДГ
- Дверь Monte 1 ДГ
- Дверь Monte 1 эмаль ДГ
- Дверь Monte 3 ДГ
- Дверь Monte 3 эмаль ДГ
- Дверь Monte 7 ДГ
- Дверь Monte 7 эмаль ДГ
- Дверь Novva 1 ДГ
- Дверь Novva 1 эмаль ДГ
- Дверь Novva 11 ДГ
- Дверь Novva 11 эмаль ДГ
- Дверь Novva 3 ДГ
- Дверь Novva 3 эмаль ДГ
- Дверь Novva 5 ДГ
- Дверь Novva 5 эмаль ДГ
- Дверь Novva 9 ДГ
- Дверь Novva 9 эмаль ДГ
- Дверь Porta Invisible
- Дверь Se1 ДГ
- Дверь Se3 ДГ
- Дверь Se5 ДГ
- Дверь Venezia 1 ДГ
- Дверь Venezia 1 эмаль ДГ
- Дверь Venezia 2 ДГ
- Дверь Venezia 2 эмаль ДГ
- Дверь Гладкое ДГ
- Дверь Гладкое эмаль ДГ
- Дверь Фантом Люкс

---

### 2.3 Строки «Наценка за кромку» без соответствия в «Цены базовые»

Для этих названий моделей нет товаров дверей; правило: **Кромка включена в базовую цену** = **Нет** (строка не используется).

**Количество:** 4

- DomeoDoors_Alberti_1 ПО кр.
- ДПГ Флекс Эмаль Порта- 4AB
- ДПГ Флекс Эмаль Порта-52 4AB
- Дверь In Flain 3 ДГ КП


---

## 3. Остающиеся несоответствия (без подставляемого умолчания)

### 3.1 Модели без данных в «Цвет»

В конфигураторе для этих моделей не будет фото и вариантов цвета из листа «Цвет». Универсального умолчания нет — нужно либо добавить строки в «Цвет», либо оставить без фото/цвета.

**Количество:** 6

- Дверное полотно Rimini 12 ПО кр.
- Дверное полотно Rimini 2 ПО кр.
- Дверь Enigma 2 ДГ
- Дверь Molis 1 эмаль ДГ
- Дверь Porta Invisible
- Дверь Фантом Люкс

---

### 3.2 Модели без данных в «Опции»

Для этих моделей в БД не попадут реверс, зеркало, порог, наполнение из листа «Опции». В калькуляторе опции по модели будут недоступны или пустые.

**Количество:** 2

- Дверное полотно Rimini 12 ПО кр.
- Дверное полотно Rimini 2 ПО кр.

---

### 3.3 Модели из «Цвет» без соответствия в «Цены базовые»

Строки листа «Цвет» не привязаны ни к одной модели калькулятора.

**Количество:** 3

- Дверь Enigma 6 ДГ
- Дверь Molis 1 эмаль ДГ Исполнение
- добавить флоренцию еще

---

### 3.4 Модели из «Опции» без соответствия в «Цены базовые»

Опции этих строк не попадут в товары дверей.

**Количество:** 0


---

## 4. Калькулятор: цвет стекла

- Варианты цвета стекла по модели берутся из БД (поле `Domeo_Стекло_доступность`, данные из листа «Стекло_доступность», столбец «Доступные цвета стекол для модели»).
- Выбор цвета стекла доступен во вкладке **Покрытие и Цвет** только если у модели есть варианты (иначе стекло не доступно).
- Выбор **на цену не влияет**; значение отображается в **Спецификации**.
